<!doctype html>
<html lang="en" data-theme="mono-slate">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="app-version" content="0.11.0" />
    <title>TREKULATE - Journey mapping</title>
    <link rel="stylesheet" href="./theme.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/iconoir-icons/iconoir@main/css/iconoir.css"
    />
    <style>
      :root {
        --tk-panel-w: 392px;
        --tk-shell-gap: var(--ds-space-3, 12px);
        --tk-shell-pad: var(--ds-space-3, 10px);
        --tk-panel-blur: 8px;
        --tk-header-pad-y: var(--ds-space-3, 14px);
        --tk-header-pad-x: var(--ds-space-4, 16px);
        --tk-header-pad-bottom: var(--ds-space-3, 12px);
        --tk-control-pad-y: 6px;
        --tk-control-pad-x: 6px;
        --tk-control-gap: 6px;
        --tk-group-pad: 6px;
        --tk-group-gap: 4px;
        --tk-field-gap: 3px;
        --tk-row-gap: var(--ds-space-2, 8px);
        --tk-input-pad-y: 6px;
        --tk-input-pad-x: 8px;
        --tk-input-color-h: 24px;
        --tk-textarea-min-h: 130px;
        --tk-btn-pad-y: 8px;
        --tk-btn-pad-x: 10px;
        --tk-theme-switch-w: 100%;
        --tk-hud-inset: 10px;
        --tk-hud-pad-y: 8px;
        --tk-hud-pad-x: 10px;
        --tk-footer-pad-top: var(--ds-space-2, 8px);
        --tk-shell-breakpoint: 1080px;
        --tk-panel-mobile-min-h: 300px;
        --tk-fs-title: var(--ds-fs-4, 1.06rem);
        --tk-fs-subtle: var(--ds-fs-1, 0.82rem);
        --tk-fs-label: var(--ds-fs-2, 0.86rem);
        --tk-fs-body-mono: var(--ds-fs-1, 0.78rem);
        --tk-fs-footer: var(--ds-fs-1, 0.76rem);
        --tk-lh-body-mono: 1.35;
        --tk-letter-title: 0.12em;
        --tk-letter-subtle: 0.08em;
        --tk-letter-label: 0.02em;
        --tk-letter-button: 0.04em;
        --tk-radius-group: var(--ds-radius-2, 10px);
        --bg-0: var(--ds-bg, #051216);
        --bg-1: var(--ds-bg-elevated, #0a1f2b);
        --panel: color-mix(
          in oklab,
          var(--ds-bg-elevated, #0a1f2b) 78%,
          transparent
        );
        --line: color-mix(in oklab, var(--ds-accent, #55e9ff) 38%, transparent);
        --text: var(--ds-text, #daf7ff);
        --accent: var(--ds-accent, #55e9ff);
        --accent-2: var(--ds-info, #7dffcf);
        --danger: var(--ds-danger, #ff7070);
        --shadow: var(--ds-card-shadow, 0 0 18px rgba(85, 233, 255, 0.35));
        --radius: var(--ds-radius-3, 14px);
        --font-ui: var(
          --ds-font-sans,
          "Inter",
          "Segoe UI",
          Roboto,
          Arial,
          sans-serif
        );
        --font-display: var(
          --ds-font-sans,
          "Inter",
          "Segoe UI",
          Roboto,
          Arial,
          sans-serif
        );
        --fx-shell-glow-a: color-mix(in oklab, var(--accent) 20%, transparent);
        --fx-shell-glow-b: color-mix(
          in oklab,
          var(--accent-2) 16%,
          transparent
        );
        --fx-header-top: color-mix(in oklab, var(--accent) 18%, transparent);
        --fx-header-bottom: transparent;
        --fx-group-bg: color-mix(
          in oklab,
          var(--ds-bg-overlay, rgba(0, 0, 0, 0.25)) 55%,
          transparent
        );
        --fx-control-border: color-mix(
          in oklab,
          var(--accent) 42%,
          var(--line)
        );
        --fx-control-bg: color-mix(
          in oklab,
          var(--ds-bg-raised, #021318) 85%,
          transparent
        );
        --fx-btn-border: color-mix(in oklab, var(--accent) 58%, var(--line));
        --fx-btn-bg-top: color-mix(in oklab, var(--accent) 22%, transparent);
        --fx-btn-bg-bottom: color-mix(in oklab, var(--accent) 8%, transparent);
        --fx-danger-border: color-mix(in oklab, var(--danger) 72%, var(--line));
        --fx-danger-bg-top: color-mix(in oklab, var(--danger) 26%, transparent);
        --fx-danger-bg-bottom: color-mix(
          in oklab,
          var(--danger) 8%,
          transparent
        );
        --fx-viewer-bg-a: color-mix(in oklab, var(--accent) 16%, transparent);
        --fx-viewer-bg-b: color-mix(in oklab, var(--accent-2) 12%, transparent);
        --fx-viewer-bg-base: color-mix(
          in oklab,
          var(--ds-bg-raised, #020c0f) 92%,
          transparent
        );
        --fx-hud-bg: color-mix(
          in oklab,
          var(--ds-bg-elevated, #041218) 70%,
          transparent
        );
        --tk-country-outline: color-mix(
          in oklab,
          var(--accent-2) 42%,
          transparent
        );
        --tk-country-shadow: color-mix(in oklab, var(--accent) 72%, white 12%);
        --tk-scanline: color-mix(in oklab, var(--accent) 14%, transparent);
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        margin: 0;
        width: 100%;
        height: 100%;
        background:
          radial-gradient(
            1200px 800px at 85% -20%,
            var(--fx-shell-glow-a),
            transparent 60%
          ),
          radial-gradient(
            900px 700px at -15% 120%,
            var(--fx-shell-glow-b),
            transparent 50%
          ),
          linear-gradient(160deg, var(--bg-0), var(--bg-1));
        color: var(--text);
        font-family: var(--font-ui);
        overflow: hidden;
      }

      .shell {
        display: grid;
        grid-template-columns: var(--tk-panel-w) 1fr;
        grid-template-rows: 1fr auto;
        gap: var(--tk-shell-gap);
        width: 100%;
        height: 100%;
        padding: var(--tk-shell-pad);
      }

      .panel {
        background: var(--panel);
        border: var(--ds-border-w, 1px) var(--ds-border-style, solid)
          var(--line);
        border-radius: var(--radius);
        backdrop-filter: blur(var(--tk-panel-blur));
        box-shadow: var(--shadow);
        overflow: hidden;
        display: flex;
        flex-direction: column;
        min-height: 0;
        grid-column: 1;
        grid-row: 1 / span 2;
        min-width: 0;
      }

      .header {
        padding: var(--tk-header-pad-y) var(--tk-header-pad-x)
          var(--tk-header-pad-bottom);
        border-bottom: var(--ds-border-w, 1px) var(--ds-border-style, solid)
          var(--line);
        display: flex;
        align-items: baseline;
        justify-content: flex-start;
        background: linear-gradient(
          180deg,
          var(--fx-header-top),
          var(--fx-header-bottom)
        );
        gap: var(--ds-space-2);
      }

      .title {
        margin: 0;
        font-family: var(--font-display);
        letter-spacing: 0.03em;
        font-size: var(--ds-fs-3, 16px);
        font-weight: 600;
      }

      .subtle {
        font-size: var(--ds-fs-1, 12px);
        opacity: 0.85;
        letter-spacing: var(--ds-label-spacing, 0.06em);
        text-transform: var(--ds-label-transform, uppercase);
        color: var(--ds-text-muted);
      }

      .panel-body {
        display: grid;
        grid-template-columns: 44px 1fr;
        min-height: 0;
        flex: 1;
        min-width: 0;
      }

      .controls {
        overflow: auto;
        padding: var(--tk-control-pad-y) var(--tk-control-pad-x)
          var(--tk-control-pad-x);
        display: block;
        min-height: 0;
        height: 100%;
        min-width: 0;
        overflow-x: hidden;
      }

      .tabs {
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
        gap: 6px;
        padding: 8px 6px;
        border-right: var(--ds-border-w) var(--ds-border-style) var(--line);
        background: color-mix(in oklab, var(--panel) 86%, transparent);
        min-height: 0;
        overflow-y: auto;
        overflow-x: hidden;
      }

      .tabs-divider {
        width: 24px;
        height: 1px;
        margin: 2px 0;
        background: color-mix(in oklab, var(--line) 80%, transparent);
      }

      .tab-btn {
        width: 32px;
        min-height: 32px;
        padding: 0;
        font-size: 12px;
        line-height: 1;
        font-weight: 700;
        margin: 0;
      }

      .tab-btn i,
      .timeline-bar .ds-btn i {
        font-size: 16px;
        line-height: 1;
        display: inline-block;
        vertical-align: middle;
      }

      .tab-btn[aria-selected="true"],
      .tab-btn.is-active {
        border-color: var(--ds-accent);
        background: color-mix(in oklab, var(--ds-accent) 16%, var(--ds-btn-bg));
        color: var(--ds-accent);
      }

      .tab-btn.is-active i,
      .tab-btn[aria-selected="true"] i {
        color: var(--ds-accent);
      }

      .control-tab[hidden] {
        display: none;
      }

      .control-tab {
        display: grid;
        gap: var(--tk-control-gap);
        align-content: start;
        align-items: start;
        min-height: 0;
      }

      #panelMapping {
        grid-template-rows: auto minmax(0, 1fr);
        height: 100%;
      }

      .group {
        display: grid;
        gap: var(--tk-group-gap);
        border: var(--ds-border-w) var(--ds-border-style) var(--line);
        border-radius: var(--ds-radius-2);
        padding: var(--tk-group-pad);
        background: color-mix(in oklab, var(--panel) 92%, transparent);
        min-width: 0;
        align-content: start;
        align-self: start;
        height: auto;
      }

      .group h3 {
        margin: 0;
        font-family: var(--font-display);
        font-size: var(--ds-fs-2, 14px);
        letter-spacing: 0.01em;
        text-transform: none;
        color: var(--text);
        font-weight: 600;
      }

      .group-head {
        display: grid;
        grid-template-columns: 1fr auto auto;
        align-items: center;
        gap: 6px;
      }

      .panel-help i,
      .group-toggle i {
        color: var(--ds-text-muted);
      }

      .group.is-collapsed > :not(.group-head) {
        display: none;
      }

      .group.is-collapsed {
        gap: 0;
      }

      label {
        display: grid;
        gap: 6px;
        font-size: var(--ds-fs-1);
        letter-spacing: var(--ds-label-spacing);
        text-transform: var(--ds-label-transform);
        color: var(--ds-text-muted);
      }

      .row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: var(--tk-row-gap);
        min-width: 0;
        align-items: start;
      }

      .controls .ds-input,
      .controls .ds-select,
      .controls .ds-textarea {
        font-size: var(--ds-fs-2);
      }

      .controls input[type="color"] {
        width: 100%;
        min-height: var(--tk-input-color-h);
        height: var(--tk-input-color-h);
        border: var(--ds-border-w) var(--ds-border-style) var(--ds-input-border);
        border-radius: var(--ds-radius-2);
        background: var(--ds-input-bg);
        padding: 2px;
        cursor: pointer;
      }

      .controls input[type="range"] {
        width: 100%;
        accent-color: var(--ds-accent);
      }

      .controls textarea {
        resize: vertical;
      }

      .btn-row {
        display: flex;
        flex-wrap: wrap;
        justify-content: flex-end;
        gap: var(--tk-row-gap);
        min-width: 0;
      }

      .btn-row .ds-btn {
        flex: 0 0 auto;
      }

      .group .ds-btn {
        min-height: 30px;
        padding: 0 8px;
        margin: 0;
        font-size: 11px;
        letter-spacing: 0.01em;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .ds-btn.is-busy {
        opacity: 0.8;
        pointer-events: none;
      }

      .theme-switch {
        width: var(--tk-theme-switch-w);
      }

      .viewer {
        position: relative;
        grid-column: 2;
        grid-row: 1;
        border-radius: var(--radius);
        border: var(--ds-border-w, 1px) var(--ds-border-style, solid)
          var(--line);
        overflow: hidden;
        box-shadow: var(--shadow);
        background:
          radial-gradient(
            55% 55% at 30% 10%,
            var(--fx-viewer-bg-a),
            transparent 70%
          ),
          radial-gradient(
            45% 45% at 90% 90%,
            var(--fx-viewer-bg-b),
            transparent 70%
          ),
          var(--fx-viewer-bg-base);
        min-width: 0;
      }

      canvas {
        width: 100%;
        height: 100%;
        display: block;
      }

      .hud {
        position: absolute;
        inset: var(--tk-hud-inset) var(--tk-hud-inset) auto auto;
        border: var(--ds-border-w, 1px) var(--ds-border-style, solid)
          var(--line);
        background: var(--fx-hud-bg);
        padding: var(--tk-hud-pad-y) var(--tk-hud-pad-x);
        border-radius: var(--ds-radius-2, 10px);
        font-size: var(--tk-fs-body-mono);
        line-height: var(--tk-lh-body-mono);
        text-align: right;
        letter-spacing: var(--tk-letter-button);
      }

      .hud-camera {
        position: absolute;
        left: var(--tk-hud-inset);
        bottom: var(--tk-hud-inset);
        border: var(--ds-border-w, 1px) var(--ds-border-style, solid)
          var(--line);
        background: var(--fx-hud-bg);
        border-radius: var(--ds-radius-2, 10px);
        padding: 6px;
        display: grid;
        gap: 6px;
        z-index: 2;
        backdrop-filter: blur(4px);
      }

      .hud-camera .camera-gizmo {
        grid-template-columns: repeat(3, 28px);
        grid-template-rows: repeat(3, 28px);
      }

      .hud-camera .camera-gizmo .ds-btn {
        width: 28px;
        min-height: 28px;
      }

      .footer {
        font-size: var(--ds-fs-1);
        opacity: 0.86;
        border-top: var(--ds-border-w, 1px) var(--ds-border-style, solid)
          var(--line);
        padding-top: var(--tk-footer-pad-top);
        color: var(--ds-text-muted);
        text-transform: none;
        letter-spacing: 0;
      }

      .timeline-bar {
        grid-column: 2;
        grid-row: 2;
        display: flex;
        flex-direction: column;
        align-items: stretch;
        gap: 6px;
        padding: 8px;
        border: var(--ds-border-w) var(--ds-border-style) var(--line);
        border-radius: var(--radius);
        background: var(--panel);
        backdrop-filter: blur(var(--tk-panel-blur));
        box-shadow: var(--shadow);
        min-width: 0;
      }

      .timeline-tools {
        display: flex;
        align-items: center;
        gap: 6px;
        min-width: 0;
      }

      .timeline-tools .spacer {
        flex: 1;
        min-width: 0;
      }

      .timeline-tools .speed-wrap {
        width: 140px;
      }

      .timeline-slider-wrap {
        display: grid;
        gap: 4px;
        min-width: 0;
        width: 100%;
      }

      .timeline-track-wrap {
        position: relative;
        min-height: 42px;
        display: flex;
        align-items: center;
        width: 100%;
        border: var(--ds-border-w) var(--ds-border-style)
          color-mix(in oklab, var(--line) 75%, transparent);
        border-radius: 4px;
        background: linear-gradient(
          180deg,
          color-mix(in oklab, var(--panel) 90%, black 10%),
          color-mix(in oklab, var(--panel) 80%, black 20%)
        );
        padding: 0 6px;
        overflow: hidden;
      }

      #timeline {
        width: 100%;
        min-width: 0;
        display: block;
        z-index: 2;
        appearance: none;
        -webkit-appearance: none;
        background: transparent;
        height: 16px;
        margin: 0;
      }

      #timeline:focus {
        outline: none;
      }

      #timeline::-webkit-slider-runnable-track {
        height: 4px;
        background: color-mix(in oklab, var(--line) 42%, transparent);
        border-radius: 2px;
        border: 0;
      }

      #timeline::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 1px;
        height: 14px;
        margin-top: -5px;
        border: 0;
        border-radius: 0;
        background: transparent;
        box-shadow: none;
      }

      #timeline::-moz-range-track {
        height: 4px;
        background: color-mix(in oklab, var(--line) 42%, transparent);
        border-radius: 2px;
        border: 0;
      }

      #timeline::-moz-range-thumb {
        width: 1px;
        height: 14px;
        border: 0;
        border-radius: 0;
        background: transparent;
        box-shadow: none;
      }

      .timeline-markers {
        position: absolute;
        inset: 12px 6px 12px 6px;
        pointer-events: none;
        z-index: 3;
      }

      .timeline-marker {
        position: absolute;
        top: 1px;
        width: 10px;
        height: 8px;
        min-width: 10px;
        min-height: 8px;
        clip-path: polygon(0 0, 100% 0, 50% 100%);
        border: 0;
        background: color-mix(in oklab, var(--ds-accent) 54%, transparent);
        box-shadow: 0 0 4px
          color-mix(in oklab, var(--ds-accent) 62%, transparent);
        transform: translateX(-50%);
        pointer-events: auto;
        cursor: pointer;
      }

      .timeline-marker.is-active {
        background: color-mix(
          in oklab,
          var(--ds-accent-strong, var(--ds-accent)) 84%,
          white 16%
        );
        box-shadow: 0 0 7px
          color-mix(in oklab, var(--ds-accent) 82%, transparent);
      }

      .timeline-ruler {
        position: absolute;
        left: 6px;
        right: 6px;
        top: 18px;
        height: 12px;
        pointer-events: none;
        background: repeating-linear-gradient(
          to right,
          color-mix(in oklab, var(--line) 86%, transparent) 0 1px,
          transparent 1px calc(5% - 1px),
          color-mix(in oklab, var(--line) 48%, transparent) calc(5% - 1px) 5%
        );
        z-index: 1;
      }

      .timeline-ruler-labels {
        position: absolute;
        left: 6px;
        right: 6px;
        top: 2px;
        display: flex;
        justify-content: space-between;
        font-size: 9px;
        color: var(--ds-text-muted);
        letter-spacing: 0.03em;
        line-height: 1;
        padding: 0;
        user-select: none;
        pointer-events: none;
        z-index: 4;
      }

      .timeline-playhead {
        position: absolute;
        top: 6px;
        bottom: 6px;
        width: 2px;
        background: color-mix(in oklab, var(--ds-accent) 92%, white 8%);
        box-shadow: 0 0 6px
          color-mix(in oklab, var(--ds-accent) 72%, transparent);
        transform: translateX(-50%);
        pointer-events: none;
        z-index: 5;
      }

      .timeline-playhead::before {
        content: "";
        position: absolute;
        top: -5px;
        left: 50%;
        transform: translateX(-50%);
        width: 12px;
        height: 8px;
        clip-path: polygon(0 0, 100% 0, 50% 100%);
        background: color-mix(in oklab, var(--ds-accent) 88%, white 12%);
        box-shadow: 0 0 6px
          color-mix(in oklab, var(--ds-accent) 66%, transparent);
      }

      #panelRaw {
        height: 100%;
        min-height: 0;
        align-content: stretch;
        align-items: stretch;
      }

      #panelDebug {
        height: 100%;
        min-height: 0;
        align-content: stretch;
        align-items: stretch;
      }

      .raw-json-group {
        height: 100%;
        min-height: 0;
        align-self: stretch;
        display: grid;
        grid-template-rows: auto minmax(0, 1fr);
      }

      #rawJsonView,
      #debugView {
        height: 100%;
        min-height: 0;
        resize: none;
      }

      .render-stack {
        display: grid;
        gap: 10px;
        align-content: start;
      }

      .render-group {
        display: grid;
        gap: 6px;
        padding-top: 8px;
        border-top: var(--ds-border-w) var(--ds-border-style)
          color-mix(in oklab, var(--line) 70%, transparent);
      }

      .render-group:first-child {
        border-top: 0;
        padding-top: 0;
      }

      .render-group h4 {
        margin: 0;
        font-size: 11px;
        font-weight: 600;
        color: var(--ds-text-muted);
        letter-spacing: 0.04em;
        text-transform: uppercase;
      }

      .layer-head {
        display: grid;
        grid-template-columns: 1fr auto;
        align-items: center;
        gap: 6px;
      }

      .layer-vis {
        width: 22px;
        min-height: 22px;
        padding: 0;
        font-size: 0;
      }

      .layer-vis i {
        font-size: 13px;
        color: var(--ds-text-muted);
      }

      .layer-vis.is-on i {
        color: var(--ds-accent);
      }

      .render-row {
        display: grid;
        grid-template-columns: 18px 1fr 168px;
        gap: 6px;
        align-items: center;
        min-height: 0;
      }

      .render-label {
        font-size: 10px;
        letter-spacing: 0.04em;
        text-transform: uppercase;
        color: var(--ds-text-muted);
        white-space: nowrap;
      }

      .render-row.color-row input[type="color"] {
        width: 34px;
        min-height: 18px;
        height: 18px;
        padding: 1px;
      }

      .render-row input[type="range"],
      .render-row select,
      .render-row input[type="color"],
      .render-row .ds-btn {
        width: 100%;
        min-width: 0;
        justify-self: stretch;
      }

      .render-row input[type="range"] {
        min-width: 0;
        max-width: none;
      }

      .render-row .geo-toggle {
        width: 16px;
        height: 16px;
        justify-self: start;
        accent-color: var(--ds-accent);
        margin: 0;
      }

      .mini-key {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        color: var(--ds-text-muted);
      }

      .mini-key i {
        font-size: 14px;
        line-height: 1;
      }

      .pin-list {
        max-height: none;
        min-height: 120px;
        height: 100%;
        overflow: auto;
        padding: 0;
        border-top: var(--ds-border-w) var(--ds-border-style)
          color-mix(in oklab, var(--line) 78%, transparent);
        border-bottom: var(--ds-border-w) var(--ds-border-style)
          color-mix(in oklab, var(--line) 78%, transparent);
      }

      .pin-table {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed;
        font-size: 11px;
      }

      .pin-table th,
      .pin-table td {
        padding: 5px 6px;
        border-bottom: var(--ds-border-w) var(--ds-border-style)
          color-mix(in oklab, var(--line) 64%, transparent);
        text-align: left;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .pin-table th {
        position: sticky;
        top: 0;
        z-index: 1;
        background: color-mix(in oklab, var(--panel) 95%, transparent);
        color: var(--ds-text-muted);
        font-weight: 600;
        letter-spacing: 0.04em;
        text-transform: uppercase;
      }

      .pin-row {
        cursor: pointer;
      }

      .pin-row.is-selected {
        background: color-mix(in oklab, var(--ds-accent) 15%, transparent);
        color: var(--ds-accent);
        box-shadow: inset 0 0 0 1px
          color-mix(in oklab, var(--ds-accent) 50%, transparent);
      }

      .pin-empty {
        font-size: 11px;
        color: var(--ds-text-muted);
        padding: 8px 6px;
      }

      .camera-stack {
        display: grid;
        gap: 4px;
        align-content: start;
      }

      .camera-row {
        display: grid;
        grid-template-columns: 18px 1fr 168px;
        gap: 6px;
        align-items: center;
      }

      .camera-row input[type="range"] {
        width: 100%;
        min-width: 0;
      }

      .data-stack {
        display: grid;
        gap: 6px;
      }

      .data-row {
        display: grid;
        grid-template-columns: 18px 1fr 168px;
        gap: 6px;
        align-items: center;
      }

      .data-row input[type="range"],
      .data-row select,
      .data-row .ds-input {
        width: 100%;
        min-width: 0;
      }

      .projection-switch {
        display: inline-flex;
        gap: 4px;
        justify-self: start;
      }

      .projection-switch .ds-btn {
        min-height: 26px;
        padding: 0 10px;
      }

      .projection-switch .ds-btn.is-active {
        border-color: var(--ds-accent);
        color: var(--ds-accent);
        background: color-mix(in oklab, var(--ds-accent) 14%, var(--ds-btn-bg));
      }

      .section-divider {
        height: 1px;
        margin: 4px 0;
        border: 0;
        background: color-mix(in oklab, var(--line) 72%, transparent);
      }

      .camera-actions {
        display: grid;
        grid-template-columns: 1fr;
        gap: 4px;
      }

      .camera-gizmo-wrap {
        display: grid;
        gap: 4px;
        justify-items: center;
        align-content: start;
      }

      .camera-gizmo {
        display: grid;
        grid-template-columns: repeat(3, 30px);
        grid-template-rows: repeat(3, 28px);
        gap: 4px;
        align-items: center;
        justify-items: center;
      }

      .camera-gizmo .ds-btn {
        width: 30px;
        min-height: 28px;
        padding: 0;
      }

      .g-front {
        grid-column: 1;
        grid-row: 1;
      }
      .g-top {
        grid-column: 2;
        grid-row: 1;
      }
      .g-back {
        grid-column: 3;
        grid-row: 1;
      }
      .g-left {
        grid-column: 1;
        grid-row: 2;
      }
      .g-home {
        grid-column: 2;
        grid-row: 2;
      }
      .g-right {
        grid-column: 3;
        grid-row: 2;
      }
      .g-iso {
        grid-column: 1;
        grid-row: 3;
      }
      .g-bottom {
        grid-column: 2;
        grid-row: 3;
      }
      .g-fit {
        grid-column: 3;
        grid-row: 3;
      }

      .camera-presets-row {
        display: flex;
        gap: 4px;
        justify-content: center;
        flex-wrap: wrap;
      }

      .camera-presets-row .ds-btn {
        min-width: 30px;
        min-height: 28px;
        padding: 0 8px;
      }

      .meta-actions {
        display: flex;
        flex-wrap: wrap;
        justify-content: flex-end;
        gap: 6px;
      }

      .meta-actions .ds-btn {
        flex: 0 0 auto;
      }

      .pins-meta-group {
        min-height: 0;
        height: 100%;
        align-self: stretch;
        display: grid;
        grid-template-rows: auto minmax(0, 1fr) auto auto;
      }

      .group.is-collapsed.raw-json-group,
      .group.is-collapsed.pins-meta-group {
        height: auto;
        min-height: 0;
        align-self: start;
        grid-template-rows: auto;
      }

      .metadata-block {
        display: grid;
        gap: 4px;
        align-content: end;
      }

      .mapping-route-row {
        position: sticky;
        top: 0;
        z-index: 3;
        padding: 6px;
        border-top: var(--ds-border-w) var(--ds-border-style) var(--line);
        border-bottom: var(--ds-border-w) var(--ds-border-style) var(--line);
        display: grid;
        gap: 6px;
        background: color-mix(in oklab, var(--panel) 96%, transparent);
      }

      .mapping-status-row {
        margin-top: 4px;
      }

      #pinSource {
        font-size: 11px;
        color: var(--ds-text-muted);
        min-height: 16px;
      }

      .toast-wrap {
        position: fixed;
        right: 12px;
        bottom: 12px;
        z-index: var(--ds-z-toast, 500);
        display: grid;
        gap: 6px;
        max-width: 320px;
      }

      .toast {
        border: var(--ds-border-w) var(--ds-border-style) var(--ds-border);
        border-radius: var(--ds-radius-2);
        background: var(--ds-bg-elevated);
        color: var(--ds-text);
        font-size: 12px;
        padding: 8px 10px;
        box-shadow: var(--ds-shadow-sm);
      }

      .toast.ok {
        border-color: color-mix(
          in oklab,
          var(--ds-success) 50%,
          var(--ds-border)
        );
      }

      .toast.warn {
        border-color: color-mix(
          in oklab,
          var(--ds-warning) 50%,
          var(--ds-border)
        );
      }

      .toast.err {
        border-color: color-mix(
          in oklab,
          var(--ds-danger) 50%,
          var(--ds-border)
        );
      }

      .panel {
        grid-column: 1;
        grid-row: 1 / span 2;
      }

      .rail-spacer {
        flex: 1;
      }

      .timeline-tools .route-btn {
        min-width: 72px;
        justify-content: center;
      }

      .timeline-tools .route-btn i {
        font-size: 14px;
      }

      dialog.ds-modal {
        padding: 0;
        border: 0;
        background: transparent;
        width: 100%;
        max-width: 100%;
      }

      dialog.ds-modal[open] {
        position: fixed;
        inset: 0;
        display: grid;
        place-items: center;
        margin: 0;
      }

      dialog.ds-modal::backdrop {
        background: color-mix(in oklab, var(--ds-bg) 55%, transparent);
        backdrop-filter: blur(2px);
      }

      @media (max-width: 1080px) {
        .shell {
          grid-template-columns: 1fr;
          grid-template-rows: 40% 1fr auto;
        }
        .panel {
          grid-column: 1;
          grid-row: 2;
          min-height: 320px;
        }
        .panel-body {
          grid-template-columns: 40px 1fr;
          min-height: 0;
        }
        .viewer {
          grid-column: 1;
          grid-row: 1;
        }
        .timeline-bar {
          grid-column: 1;
          grid-row: 3;
        }
        .timeline-tools .speed-wrap {
          width: 110px;
        }
        .rail-spacer {
          display: none;
        }
      }
    </style>
  </head>
  <body>
    <main class="shell">
      <section class="panel">
        <header class="header">
          <h1 class="title">TREKULATE</h1>
          <span class="subtle">v0.8 wireframe</span>
        </header>
        <div class="panel-body">
          <div class="tabs ds-scroll">
            <button
              class="ds-btn tab-btn is-active"
              id="tabMapping"
              data-tab="mapping"
              aria-selected="true"
              title="Pins"
            >
              <i class="iconoir-map-pin" aria-hidden="true"></i>
            </button>
            <button
              class="ds-btn tab-btn"
              id="tabData"
              data-tab="data"
              aria-selected="false"
              title="Data and Import"
            >
              <i class="iconoir-map" aria-hidden="true"></i>
            </button>
            <div class="tabs-divider" aria-hidden="true"></div>
            <button
              class="ds-btn tab-btn"
              id="tabRendering"
              data-tab="rendering"
              aria-selected="false"
              title="Rendering"
            >
              <i class="iconoir-cube" aria-hidden="true"></i>
            </button>
            <button
              class="ds-btn tab-btn"
              id="tabCamera"
              data-tab="camera"
              aria-selected="false"
              title="Camera"
            >
              <i class="iconoir-camera" aria-hidden="true"></i>
            </button>
            <button
              class="ds-btn tab-btn"
              id="tabExport"
              data-tab="export"
              aria-selected="false"
              title="Export"
            >
              <i class="iconoir-folder" aria-hidden="true"></i>
            </button>
            <div class="rail-spacer"></div>
            <button
              class="ds-btn tab-btn"
              id="tabRaw"
              data-tab="raw"
              aria-selected="false"
              title="Raw JSON"
            >
              <i class="iconoir-code" aria-hidden="true"></i>
            </button>
            <button
              class="ds-btn tab-btn"
              id="tabDebug"
              data-tab="debug"
              aria-selected="false"
              title="Debug"
            >
              <i class="iconoir-terminal-tag" aria-hidden="true"></i>
            </button>
            <div class="tabs-divider" aria-hidden="true"></div>
            <button
              class="ds-btn tab-btn"
              id="tabSettings"
              data-tab="settings"
              aria-selected="false"
              title="Settings"
            >
              <i class="iconoir-settings" aria-hidden="true"></i>
            </button>
          </div>
          <div class="controls ds-scroll">
            <section
              class="control-tab"
              id="panelMapping"
              data-tab-panel="mapping"
            >
              <div class="group">
                <div class="group-head">
                  <h3>Add Pins</h3>
                  <button
                    class="ds-btn ds-btn-icon ds-btn-sm panel-help"
                    type="button"
                    data-help="Paste CSV rows or Google Maps links, then use Add Pins. Successful rows are removed from the input."
                    title="Help"
                  >
                    <i class="iconoir-info-circle"></i>
                  </button>
                </div>
                <textarea
                  id="pinData"
                  class="ds-textarea"
                  placeholder="Paste rows as: lat,lng,label,timestamp,note&#10;or paste Google Maps share links (one per line)"
                >
37.7749,-122.4194,San Francisco
34.0522,-118.2437,Los Angeles
36.1699,-115.1398,Las Vegas
40.7608,-111.8910,Salt Lake City
47.6062,-122.3321,Seattle</textarea
                >
                <div class="btn-row">
                  <button class="ds-btn" id="clearInput">Clear Input</button>
                  <button class="ds-btn" id="parsePreview">Preview</button>
                  <button class="ds-btn ds-btn-primary" id="loadPins">
                    Add Pins
                  </button>
                </div>
                <div
                  id="pinParseStatus"
                  class="panel-status ds-status mapping-status-row"
                >
                  Ready.
                </div>
              </div>
              <div class="group pins-meta-group">
                <div class="group-head">
                  <h3>Pins + Metadata</h3>
                  <button
                    class="ds-btn ds-btn-icon ds-btn-sm panel-help"
                    type="button"
                    data-help="Select a pin from the list to edit metadata. Save activates only after changes."
                    title="Help"
                  >
                    <i class="iconoir-info-circle"></i>
                  </button>
                </div>
                <div id="pinList" class="pin-list ds-scroll">
                  <table class="pin-table" aria-label="Journey pins">
                    <thead>
                      <tr>
                        <th style="width: 38%">Label</th>
                        <th style="width: 23%">Lat</th>
                        <th style="width: 23%">Lng</th>
                        <th style="width: 16%">Src</th>
                      </tr>
                    </thead>
                    <tbody id="pinTableBody"></tbody>
                  </table>
                </div>
                <div class="metadata-block">
                  <input
                    id="pinLabel"
                    class="ds-input"
                    type="text"
                    placeholder="Pin label"
                  />
                  <input
                    id="pinTimestamp"
                    class="ds-input"
                    type="datetime-local"
                    title="Timestamp"
                  />
                  <textarea
                    id="pinNote"
                    class="ds-textarea"
                    rows="3"
                    style="min-height: 74px"
                    placeholder="Pin note"
                  ></textarea>
                  <div id="pinSource"></div>
                </div>
                <div class="meta-actions">
                  <button class="ds-btn ds-btn-danger" id="deletePin">
                    Delete
                  </button>
                  <button class="ds-btn" id="cancelPinMeta" disabled>
                    Cancel
                  </button>
                  <button
                    class="ds-btn ds-btn-primary"
                    id="savePinMeta"
                    disabled
                  >
                    Save
                  </button>
                </div>
              </div>
            </section>

            <section
              class="control-tab"
              id="panelRendering"
              data-tab-panel="rendering"
              hidden
            >
              <div class="group">
                <div class="group-head">
                  <h3>Rendering Controls</h3>
                  <button
                    class="ds-btn ds-btn-icon ds-btn-sm panel-help"
                    type="button"
                    data-help="Layer order: Pins, Path, Outline, Lat/Lng Grid, Topography, Sea Level. Use color + width + opacity controls for each layer."
                    title="Help"
                  >
                    <i class="iconoir-info-circle"></i>
                  </button>
                </div>
                <div class="render-stack">
                  <section class="render-group">
                    <div class="layer-head">
                      <h4>Pins</h4>
                      <button
                        class="ds-btn layer-vis is-on"
                        id="visPins"
                        type="button"
                        title="Show/hide Pins"
                      >
                        <i class="iconoir-eye" aria-hidden="true"></i>
                      </button>
                    </div>
                    <div class="render-row color-row">
                      <span class="mini-key" title="Color"
                        ><i class="iconoir-color-picker" aria-hidden="true"></i
                      ></span>
                      <span class="render-label">Pin Color</span>
                      <input
                        id="pinColor"
                        type="color"
                        value="#f2fdff"
                        title="Pin color"
                      />
                    </div>
                    <div class="render-row color-row">
                      <span class="mini-key" title="Label color"
                        ><i class="iconoir-text-box" aria-hidden="true"></i
                      ></span>
                      <span class="render-label">Label Color</span>
                      <input
                        id="pinLabelColor"
                        type="color"
                        value="#f2fdff"
                        title="Pin label color"
                      />
                    </div>
                    <div class="render-row">
                      <span class="mini-key" title="Size"
                        ><i class="iconoir-diameter" aria-hidden="true"></i
                      ></span>
                      <span class="render-label">Size</span>
                      <input
                        id="pinSize"
                        type="range"
                        min="2"
                        max="12"
                        value="6"
                        step="1"
                        title="Pin size"
                      />
                    </div>
                  </section>

                  <section class="render-group">
                    <div class="layer-head">
                      <h4>Path</h4>
                      <button
                        class="ds-btn layer-vis is-on"
                        id="visPath"
                        type="button"
                        title="Show/hide Path"
                      >
                        <i class="iconoir-eye" aria-hidden="true"></i>
                      </button>
                    </div>
                    <div class="render-row color-row">
                      <span class="mini-key" title="Color"
                        ><i class="iconoir-color-picker" aria-hidden="true"></i
                      ></span>
                      <span class="render-label">Color</span>
                      <input
                        id="pathColor"
                        type="color"
                        value="#8dffcf"
                        title="Path color"
                      />
                    </div>
                    <div class="render-row">
                      <span class="mini-key" title="Opacity"
                        ><i
                          class="iconoir-substract"
                          aria-hidden="true"
                        ></i
                      ></span>
                      <span class="render-label">Opacity</span>
                      <input
                        id="pathOpacity"
                        type="range"
                        min="0.05"
                        max="1"
                        value="0.82"
                        step="0.01"
                        title="Path opacity"
                      />
                    </div>
                    <div class="render-row">
                      <span class="mini-key" title="Width"
                        ><i class="iconoir-line-space" aria-hidden="true"></i
                      ></span>
                      <span class="render-label">Width</span>
                      <input
                        id="pathWidth"
                        type="range"
                        min="1"
                        max="7"
                        value="3"
                        step="0.5"
                        title="Path width"
                      />
                    </div>
                  </section>

                  <section class="render-group">
                    <div class="layer-head">
                      <h4>Outline</h4>
                      <button
                        class="ds-btn layer-vis is-on"
                        id="visOutline"
                        type="button"
                        title="Show/hide Outline"
                      >
                        <i class="iconoir-eye" aria-hidden="true"></i>
                      </button>
                    </div>
                    <div class="render-row color-row">
                      <span class="mini-key" title="Color"
                        ><i class="iconoir-color-picker" aria-hidden="true"></i
                      ></span>
                      <span class="render-label">Color</span>
                      <input
                        id="outlineColor"
                        type="color"
                        value="#8dffcf"
                        title="Outline color"
                      />
                    </div>
                    <div class="render-row">
                      <span class="mini-key" title="Opacity"
                        ><i
                          class="iconoir-substract"
                          aria-hidden="true"
                        ></i
                      ></span>
                      <span class="render-label">Opacity</span>
                      <input
                        id="outlineOpacity"
                        type="range"
                        min="0.05"
                        max="1"
                        value="0.62"
                        step="0.01"
                        title="Outline opacity"
                      />
                    </div>
                    <div class="render-row">
                      <span class="mini-key" title="Width"
                        ><i class="iconoir-line-space" aria-hidden="true"></i
                      ></span>
                      <span class="render-label">Width</span>
                      <input
                        id="outlineWidth"
                        type="range"
                        min="0.6"
                        max="3.2"
                        value="1.2"
                        step="0.1"
                        title="Outline width"
                      />
                    </div>
                  </section>

                  <section class="render-group">
                    <div class="layer-head">
                      <h4>Lat/Lng Grid</h4>
                      <button
                        class="ds-btn layer-vis is-on"
                        id="visGeoGrid"
                        type="button"
                        title="Show/hide Lat/Lng Grid"
                      >
                        <i class="iconoir-eye" aria-hidden="true"></i>
                      </button>
                    </div>
                    <div class="render-row color-row">
                      <span class="mini-key" title="Color"
                        ><i class="iconoir-color-picker" aria-hidden="true"></i
                      ></span>
                      <span class="render-label">Color</span>
                      <input
                        id="geoGridColor"
                        type="color"
                        value="#7dcbff"
                        title="Grid color"
                      />
                    </div>
                    <div class="render-row">
                      <span class="mini-key" title="Opacity"
                        ><i
                          class="iconoir-substract"
                          aria-hidden="true"
                        ></i
                      ></span>
                      <span class="render-label">Opacity</span>
                      <input
                        id="geoGridOpacity"
                        type="range"
                        min="0.05"
                        max="1"
                        value="0.22"
                        step="0.01"
                        title="Grid opacity"
                      />
                    </div>
                    <div class="render-row">
                      <span class="mini-key" title="Width"
                        ><i class="iconoir-line-space" aria-hidden="true"></i
                      ></span>
                      <span class="render-label">Width</span>
                      <input
                        id="geoGridWidth"
                        type="range"
                        min="0.5"
                        max="3"
                        value="1"
                        step="0.1"
                        title="Grid width"
                      />
                    </div>
                    <div class="render-row">
                      <span class="mini-key" title="Label opacity"
                        ><i class="iconoir-text-box" aria-hidden="true"></i
                      ></span>
                      <span class="render-label">Label Opacity</span>
                      <input
                        id="geoLabelOpacity"
                        type="range"
                        min="0"
                        max="1"
                        value="0.68"
                        step="0.01"
                        title="Label opacity"
                      />
                    </div>

                    <div class="render-row">
                      <span class="mini-key" title="Latitude increment"
                        ><i
                          class="iconoir-arrows-up-down"
                          aria-hidden="true"
                        ></i
                      ></span>
                      <span class="render-label">Lat Increment</span>
                      <input
                        id="geoLatStep"
                        type="range"
                        min="0.1"
                        max="30"
                        value="2"
                        step="0.1"
                        title="Latitude increment"
                      />
                    </div>
                    <div class="render-row">
                      <span class="mini-key" title="Longitude increment"
                        ><i
                          class="iconoir-arrows-left-right"
                          aria-hidden="true"
                        ></i
                      ></span>
                      <span class="render-label">Lng Increment</span>
                      <input
                        id="geoLngStep"
                        type="range"
                        min="0.1"
                        max="30"
                        value="2"
                        step="0.1"
                        title="Longitude increment"
                      />
                    </div>
                    <div class="render-row">
                      <span class="mini-key" title="Link increments"
                        ><i class="iconoir-link" aria-hidden="true"></i
                      ></span>
                      <span class="render-label">Link Increments</span>
                      <input
                        id="geoStepLink"
                        class="geo-toggle"
                        type="checkbox"
                        checked
                        title="Link lat/lng increments"
                        aria-label="Link lat/lng increments"
                      />
                    </div>
                  </section>

                  <section class="render-group">
                    <div class="layer-head">
                      <h4>Topography</h4>
                      <button
                        class="ds-btn layer-vis is-on"
                        id="visTopography"
                        type="button"
                        title="Show/hide Topography"
                      >
                        <i class="iconoir-eye" aria-hidden="true"></i>
                      </button>
                    </div>
                    <div class="render-row color-row">
                      <span class="mini-key" title="Color"
                        ><i class="iconoir-color-picker" aria-hidden="true"></i
                      ></span>
                      <span class="render-label">Color</span>
                      <input
                        id="topoColor"
                        type="color"
                        value="#8dffcf"
                        title="Topography color"
                      />
                    </div>
                    <div class="render-row">
                      <span class="mini-key" title="Opacity"
                        ><i
                          class="iconoir-substract"
                          aria-hidden="true"
                        ></i
                      ></span>
                      <span class="render-label">Opacity</span>
                      <input
                        id="topoOpacity"
                        type="range"
                        min="0.1"
                        max="1"
                        value="0.68"
                        step="0.01"
                        title="Topography opacity"
                      />
                    </div>
                    <div class="render-row">
                      <span class="mini-key" title="Width"
                        ><i class="iconoir-line-space" aria-hidden="true"></i
                      ></span>
                      <span class="render-label">Width</span>
                      <input
                        id="topoLineWidth"
                        type="range"
                        min="0.5"
                        max="2.6"
                        value="1.1"
                        step="0.1"
                        title="Topography line width"
                      />
                    </div>
                    <div class="render-row">
                      <span class="mini-key" title="3D Height"
                        ><i class="iconoir-ruler-combine" aria-hidden="true"></i
                      ></span>
                      <span class="render-label">3D Height</span>
                      <input
                        id="topoHeightScale"
                        type="range"
                        min="0"
                        max="0.75"
                        value="0.26"
                        step="0.01"
                        title="Topography 3D height"
                      />
                    </div>
                  </section>

                  <section class="render-group">
                    <div class="layer-head">
                      <h4>Sea Level</h4>
                      <button
                        class="ds-btn layer-vis is-on"
                        id="visSeaLevel"
                        type="button"
                        title="Show/hide Sea Level"
                      >
                        <i class="iconoir-eye" aria-hidden="true"></i>
                      </button>
                    </div>
                    <div class="render-row">
                      <span class="mini-key" title="Pattern"
                        ><i class="iconoir-grid-minus" aria-hidden="true"></i
                      ></span>
                      <span class="render-label">Pattern</span>
                      <select
                        id="terrainPattern"
                        class="ds-select"
                        title="Sea level pattern"
                      >
                        <option value="dots" selected>Dots</option>
                        <option value="grid" >Grid</option>
                        <option value="hatch">Hatch</option>
                      </select>
                    </div>
                    <div class="render-row color-row">
                      <span class="mini-key" title="Color"
                        ><i class="iconoir-color-picker" aria-hidden="true"></i
                      ></span>
                      <span class="render-label">Color</span>
                      <input
                        id="terrainColor"
                        type="color"
                        value="#3cd7ff"
                        title="Sea level color"
                      />
                    </div>
                    <div class="render-row">
                      <span class="mini-key" title="Opacity"
                        ><i
                          class="iconoir-substract"
                          aria-hidden="true"
                        ></i
                      ></span>
                      <span class="render-label">Opacity</span>
                      <input
                        id="wireOpacity"
                        type="range"
                        min="0.05"
                        max="1"
                        value="0.35"
                        step="0.05"
                        title="Sea level opacity"
                      />
                    </div>
                    <div class="render-row">
                      <span class="mini-key" title="Glow"
                        ><i class="iconoir-half-moon" aria-hidden="true"></i
                      ></span>
                      <span class="render-label">Glow</span>
                      <input
                        id="terrainGlow"
                        type="range"
                        min="0"
                        max="2.5"
                        value="1.1"
                        step="0.1"
                        title="Sea level glow"
                      />
                    </div>
                    <div class="render-row">
                      <span class="mini-key" title="Density"
                        ><i class="iconoir-graph-up" aria-hidden="true"></i
                      ></span>
                      <span class="render-label">Density</span>
                      <input
                        id="terrainDensity"
                        type="range"
                        min="0.5"
                        max="20"
                        value="6"
                        step="0.5"
                        title="Sea level density"
                      />
                    </div>
                    <div class="render-row">
                      <span class="mini-key" title="Elevation"
                        ><i class="iconoir-ruler-combine" aria-hidden="true"></i
                      ></span>
                      <span class="render-label">Elevation</span>
                      <input
                        id="terrainHeight"
                        type="range"
                        min="-0.2"
                        max="0.5"
                        value="0"
                        step="0.01"
                        title="Sea level elevation"
                      />
                    </div>
                  </section>
                </div>
              </div>
            </section>

            <section
              class="control-tab"
              id="panelCamera"
              data-tab-panel="camera"
              hidden
            >
              <div class="group">
                <div class="group-head">
                  <h3>Camera Controls</h3>
                  <button
                    class="ds-btn ds-btn-icon ds-btn-sm panel-help"
                    type="button"
                    data-help="Left drag to orbit. Shift+left drag or middle drag to track. Wheel to dolly. Preset gizmo buttons match direction."
                    title="Help"
                  >
                    <i class="iconoir-info-circle"></i>
                  </button>
                </div>
                <div class="camera-stack">
                  <div class="camera-row">
                    <span class="mini-key" title="Yaw"
                      ><i
                        class="iconoir-rotate-camera-right"
                        aria-hidden="true"
                      ></i
                    ></span>
                    <span class="render-label">Yaw</span>
                    <input
                      id="cameraYaw"
                      type="range"
                      min="-31.4"
                      max="31.4"
                      value="-0.76"
                      step="0.01"
                      title="Yaw"
                    />
                  </div>
                  <div class="camera-row">
                    <span class="mini-key" title="Pitch"
                      ><i class="iconoir-view-360" aria-hidden="true"></i
                    ></span>
                    <span class="render-label">Pitch</span>
                    <input
                      id="cameraPitch"
                      type="range"
                      min="-6.28"
                      max="6.28"
                      value="0.93"
                      step="0.01"
                      title="Pitch"
                    />
                  </div>
                  <div class="camera-row">
                    <span class="mini-key" title="Zoom"
                      ><i class="iconoir-search" aria-hidden="true"></i
                    ></span>
                    <span class="render-label">Zoom</span>
                    <input
                      id="cameraZoom"
                      type="range"
                      min="0.35"
                      max="16"
                      value="3.4"
                      step="0.05"
                      title="Zoom"
                    />
                  </div>
                  <div class="camera-row">
                    <span class="mini-key" title="Pan X"
                      ><i
                        class="iconoir-arrows-left-right"
                        aria-hidden="true"
                      ></i
                    ></span>
                    <span class="render-label">Focus X</span>
                    <input
                      id="cameraPanX"
                      type="range"
                      min="-3.5"
                      max="3.5"
                      value="0"
                      step="0.01"
                      title="Pan X"
                    />
                  </div>
                  <div class="camera-row">
                    <span class="mini-key" title="Pan Z"
                      ><i class="iconoir-arrows-up-down" aria-hidden="true"></i
                    ></span>
                    <span class="render-label">Focus Z</span>
                    <input
                      id="cameraPanZ"
                      type="range"
                      min="-3.5"
                      max="3.5"
                      value="0"
                      step="0.01"
                      title="Pan Z"
                    />
                  </div>
                  <div class="camera-row">
                    <span class="mini-key" title="Focus Y"
                      ><i
                        class="iconoir-align-bottom-box"
                        aria-hidden="true"
                      ></i
                    ></span>
                    <span class="render-label">Focus Y</span>
                    <input
                      id="cameraPedestal"
                      type="range"
                      min="-1.2"
                      max="1.2"
                      value="0"
                      step="0.02"
                      title="Focus Y"
                    />
                  </div>
                  <div class="camera-row">
                    <span class="mini-key" title="Angle"
                      ><i
                        class="iconoir-rotate-camera-left"
                        aria-hidden="true"
                      ></i
                    ></span>
                    <span class="render-label">Roll</span>
                    <input
                      id="cameraRoll"
                      type="range"
                      min="-3.14"
                      max="3.14"
                      value="0"
                      step="0.01"
                      title="Angle"
                    />
                  </div>
                  <div class="camera-row">
                    <span class="mini-key" title="Focal length"
                      ><i class="iconoir-camera" aria-hidden="true"></i
                    ></span>
                    <span class="render-label">Focal</span>
                    <input
                      id="cameraFocal"
                      type="range"
                      min="18"
                      max="120"
                      value="50"
                      step="1"
                      title="Focal length"
                    />
                  </div>
                  <div class="camera-row">
                    <span class="mini-key" title="Lens angle"
                      ><i class="iconoir-diameter" aria-hidden="true"></i
                    ></span>
                    <span class="render-label">Lens</span>
                    <input
                      id="cameraLens"
                      type="range"
                      min="22"
                      max="95"
                      value="58"
                      step="1"
                      title="Lens angle"
                    />
                  </div>
                  <div class="camera-row">
                    <span class="mini-key" title="Focus depth"
                      ><i class="iconoir-focus" aria-hidden="true"></i
                    ></span>
                    <span class="render-label">Focus Depth</span>
                    <input
                      id="cameraFocusDepth"
                      type="range"
                      min="0.35"
                      max="18"
                      value="3.6"
                      step="0.05"
                      title="Focus depth"
                    />
                  </div>
                  <div class="camera-row">
                    <span class="mini-key" title="Depth of field"
                      ><i class="iconoir-diameter" aria-hidden="true"></i
                    ></span>
                    <span class="render-label">DOF</span>
                    <input
                      id="cameraDof"
                      type="range"
                      min="0"
                      max="1.4"
                      value="0"
                      step="0.05"
                      title="Depth of field"
                    />
                  </div>
                </div>
              </div>
            </section>

            <section
              class="control-tab"
              id="panelData"
              data-tab-panel="data"
              hidden
            >
              <div class="group">
                <div class="group-head">
                  <h3>Map Settings + Open Data</h3>
                  <button
                    class="ds-btn ds-btn-icon ds-btn-sm panel-help"
                    type="button"
                    data-help="Load country outlines from open map sources. Flat/Globe sets map projection mode. Center Lat/Lng repositions the focus window; Window Span controls the visible degree range in flat mode; Fine Scale adjusts map size. Re-run Route after pin changes."
                    title="Help"
                  >
                    <i class="iconoir-info-circle"></i>
                  </button>
                </div>
                <div class="data-stack">
                  <div class="data-row">
                    <span class="mini-key" title="Projection"
                      ><i class="iconoir-globe" aria-hidden="true"></i
                    ></span>
                    <span class="render-label">Projection</span>
                    <div
                      class="projection-switch"
                      role="group"
                      aria-label="Map projection"
                    >
                      <button
                        class="ds-btn is-active"
                        id="mapProjectionFlat"
                        type="button"
                        title="Use flat map projection"
                      >
                        Flat
                      </button>
                      <button
                        class="ds-btn"
                        id="mapProjectionGlobe"
                        type="button"
                        title="Use spherical globe projection"
                      >
                        Globe
                      </button>
                    </div>
                  </div>
                  <select
                    id="mapProjection"
                    class="ds-select"
                    hidden
                    aria-hidden="true"
                    tabindex="-1"
                  >
                    <option value="flat" selected>Flat map</option>
                    <option value="globe">Spherical globe</option>
                  </select>
                  <div class="data-row">
                    <span class="mini-key" title="Country"
                      ><i class="iconoir-map" aria-hidden="true"></i
                    ></span>
                    <span class="render-label">Country</span>
                    <input
                      id="countryName"
                      class="ds-input"
                      type="text"
                      value="United States"
                    />
                  </div>
                </div>
                <div class="btn-row">
                  <button class="ds-btn ds-btn-primary" id="loadCountry">
                    Outline
                  </button>
                </div>
                <hr class="section-divider" aria-hidden="true" />
                <div class="data-stack">
                  <div class="data-row">
                    <span class="mini-key" title="Outline filter"
                      ><i class="iconoir-filter" aria-hidden="true"></i
                    ></span>
                    <span class="render-label">Outline Filter</span>
                    <select id="outlineMainlandOnly" class="ds-select">
                      <option value="all">All territories</option>
                      <option value="mainland" selected>
                        Mainland only (largest landmass)
                      </option>
                    </select>
                  </div>
                  <div class="data-row">
                    <span class="mini-key" title="Landmass focus"
                      ><i class="iconoir-target" aria-hidden="true"></i
                    ></span>
                    <span class="render-label">Landmass Focus</span>
                    <select
                      id="outlineSegmentSelect"
                      class="ds-select"
                    ></select>
                  </div>
                </div>
                <div class="btn-row">
                  <button class="ds-btn" id="centerOutlineSegment">
                    Center Landmass
                  </button>
                </div>
                <hr class="section-divider" aria-hidden="true" />
                <div class="data-stack">
                  <div class="data-row">
                    <span class="mini-key" title="Center Lat"
                      ><i class="iconoir-arrows-up-down" aria-hidden="true"></i
                    ></span>
                    <span class="render-label">Center Lat</span>
                    <input
                      id="geoCenterLat"
                      type="range"
                      min="-85"
                      max="85"
                      value="0"
                      step="0.01"
                      title="Latitude center"
                    />
                  </div>
                  <div class="data-row">
                    <span class="mini-key" title="Center Lng"
                      ><i
                        class="iconoir-arrows-left-right"
                        aria-hidden="true"
                      ></i
                    ></span>
                    <span class="render-label">Center Lng</span>
                    <input
                      id="geoCenterLng"
                      type="range"
                      min="-180"
                      max="180"
                      value="0"
                      step="0.01"
                      title="Longitude center"
                    />
                  </div>
                  <div class="data-row">
                    <span class="mini-key" title="Window Span"
                      ><i class="iconoir-frame-select" aria-hidden="true"></i
                    ></span>
                    <span class="render-label">Window Span</span>
                    <input
                      id="geoSpanDeg"
                      type="range"
                      min="0.5"
                      max="360"
                      value="60"
                      step="0.1"
                      title="Coordinate window span"
                    />
                  </div>
                  <div class="data-row">
                    <span class="mini-key" title="Fine Scale"
                      ><i class="iconoir-diameter" aria-hidden="true"></i
                    ></span>
                    <span class="render-label">Fine Scale</span>
                    <input
                      id="geoFineScale"
                      type="range"
                      min="0.2"
                      max="4"
                      value="1"
                      step="0.01"
                      title="Fine scale"
                    />
                  </div>
                </div>
                <div class="btn-row">
                  <button class="ds-btn" id="geoNudgeW" title="Move west">
                    W
                  </button>
                  <button class="ds-btn" id="geoNudgeE" title="Move east">
                    E
                  </button>
                  <button class="ds-btn" id="geoNudgeN" title="Move north">
                    N
                  </button>
                  <button class="ds-btn" id="geoNudgeS" title="Move south">
                    S
                  </button>
                  <button
                    class="ds-btn ds-btn-primary"
                    id="fitGeoWindow"
                    title="Fit window to loaded map"
                  >
                    Fit Window
                  </button>
                </div>
              </div>
              <div class="group">
                <div class="group-head">
                  <h3>Topography Import</h3>
                  <button
                    class="ds-btn ds-btn-icon ds-btn-sm panel-help"
                    type="button"
                    data-help="MVP: loads elevation samples from OpenTopoData and renders contour wireframe. Use country outline first for best bounds."
                    title="Help"
                  >
                    <i class="iconoir-info-circle"></i>
                  </button>
                </div>
                <div class="data-stack">
                  <div class="data-row">
                    <span class="mini-key" title="Resolution"
                      ><i class="iconoir-ruler-combine" aria-hidden="true"></i
                    ></span>
                    <span class="render-label">Resolution</span>
                    <input
                      id="topoResolution"
                      type="range"
                      min="12"
                      max="42"
                      value="24"
                      step="2"
                      title="Topography sample resolution"
                    />
                  </div>
                  <div class="data-row">
                    <span class="mini-key" title="Contours"
                      ><i class="iconoir-graph-up" aria-hidden="true"></i
                    ></span>
                    <span class="render-label">Contours</span>
                    <input
                      id="topoContours"
                      type="range"
                      min="4"
                      max="24"
                      value="10"
                      step="1"
                      title="Contour levels"
                    />
                  </div>
                  <div class="data-row">
                    <span class="mini-key" title="Render mode"
                      ><i class="iconoir-view-grid" aria-hidden="true"></i
                    ></span>
                    <span class="render-label">Render Mode</span>
                    <select id="topoMode" class="ds-select">
                      <option value="contour2d" selected>2D Contours</option>
                      <option value="contour3d">3D Contours</option>
                    </select>
                  </div>
                </div>
                <div class="btn-row">
                  <button class="ds-btn ds-btn-danger" id="clearTopography">
                    Clear Topography
                  </button>
                  <button class="ds-btn ds-btn-primary" id="loadTopography">
                    Load Topography
                  </button>
                </div>
                <div id="topoStatus" class="panel-status ds-status">
                  Topography idle.
                </div>
              </div>
            </section>

            <section
              class="control-tab"
              id="panelExport"
              data-tab-panel="export"
              hidden
            >
              <div class="group">
                <h3>Export</h3>
                <div class="btn-row">
                  <button class="ds-btn ds-btn-primary" id="exportPng">
                    PNG
                  </button>
                </div>
                <div id="exportStatus" class="panel-status ds-status">
                  Ready.
                </div>
              </div>
            </section>

            <section
              class="control-tab"
              id="panelRaw"
              data-tab-panel="raw"
              hidden
            >
              <div class="group raw-json-group">
                <div class="group-head">
                  <h3>Raw JSON</h3>
                  <button
                    class="ds-btn ds-btn-icon ds-btn-sm"
                    id="refreshRaw"
                    type="button"
                    title="Refresh raw JSON preview"
                  >
                    <i class="iconoir-refresh-double" aria-hidden="true"></i>
                  </button>
                </div>
                <textarea
                  id="rawJsonView"
                  class="ds-textarea ds-scroll"
                  readonly
                ></textarea>
              </div>
            </section>

            <section
              class="control-tab"
              id="panelDebug"
              data-tab-panel="debug"
              hidden
            >
              <div class="group raw-json-group">
                <div class="group-head">
                  <h3>Debug State</h3>
                  <button
                    class="ds-btn ds-btn-icon ds-btn-sm"
                    id="refreshDebug"
                    type="button"
                    title="Refresh debug state"
                  >
                    <i class="iconoir-refresh-double" aria-hidden="true"></i>
                  </button>
                </div>
                <textarea
                  id="debugView"
                  class="ds-textarea ds-scroll"
                  readonly
                ></textarea>
              </div>
            </section>

            <section
              class="control-tab"
              id="panelSettings"
              data-tab-panel="settings"
              hidden
            >
              <div class="group">
                <h3>Settings</h3>
                <label class="subtle" for="themeSelectApp">Theme</label>
                <select
                  id="themeSelectApp"
                  class="theme-switch ds-select"
                  aria-label="Select app theme"
                >
                  <option value="steel-night">Steel Night</option>
                  <option value="paper-mint">Paper Mint</option>
                  <option value="amber-terminal">Amber Terminal</option>
                  <option value="neon-grid">Neon Grid</option>
                  <option value="mono-slate">Mono Slate</option>
                  <option value="tech-grid">Tech Grid</option>
                  <option value="skeuo-panel">Skeuo Panel</option>
                  <option value="industrial-terminal">
                    Industrial Terminal
                  </option>
                  <option value="velvet-touch">Velvet Touch</option>
                  <option value="eva-wireframe">Eva Wireframe</option>
                  <option value="eva-unit-01">Eva Unit-01</option>
                  <option value="saturn-alloy">Saturn Alloy</option>
                </select>
              </div>
            </section>
          </div>
        </div>
      </section>

      <section class="viewer">
        <canvas id="view"></canvas>
        <div class="hud-camera" aria-label="Camera view controls">
          <div class="camera-gizmo">
            <button class="ds-btn g-front" id="viewFront" title="Front">
              <i class="iconoir-view-grid" aria-hidden="true"></i>
            </button>
            <button class="ds-btn g-top" id="viewTop" title="Top">
              <i class="iconoir-nav-arrow-up" aria-hidden="true"></i>
            </button>
            <button class="ds-btn g-back" id="viewBack" title="Back">
              <i class="iconoir-view-columns-3" aria-hidden="true"></i>
            </button>
            <button class="ds-btn g-left" id="viewLeft" title="Left">
              <i class="iconoir-nav-arrow-left" aria-hidden="true"></i>
            </button>
            <button class="ds-btn g-home" id="viewHome" title="Home view">
              <i class="iconoir-home" aria-hidden="true"></i>
            </button>
            <button class="ds-btn g-right" id="viewRight" title="Right">
              <i class="iconoir-nav-arrow-right" aria-hidden="true"></i>
            </button>
            <button class="ds-btn g-iso" id="viewIso" title="Isometric">
              <i class="iconoir-cube-bandage" aria-hidden="true"></i>
            </button>
            <button class="ds-btn g-bottom" id="viewBottom" title="Bottom">
              <i class="iconoir-nav-arrow-down" aria-hidden="true"></i>
            </button>
            <button class="ds-btn g-fit" id="viewFit" title="Fit map to frame">
              <i class="iconoir-frame-select" aria-hidden="true"></i>
            </button>
          </div>
        </div>
        <div class="hud">
          <div id="hudPins">Pins: 0</div>
          <div id="hudPath">Path nodes: 0</div>
          <div id="hudTime">Timeline: 0%</div>
          <div id="hudCam">Cam: y -0.76 p 0.93 z 3.4</div>
          <div id="hudFps">FPS: --</div>
        </div>
      </section>

      <section class="timeline-bar">
        <div class="timeline-tools">
          <button
            class="ds-btn ds-btn-primary ds-btn-icon ds-btn-sm"
            id="playPause"
            title="Play/Pause"
          >
            <i class="iconoir-play-solid" aria-hidden="true"></i>
          </button>
          <button
            class="ds-btn ds-btn-icon ds-btn-sm"
            id="reset"
            title="Reset timeline"
          >
            <i class="iconoir-restart" aria-hidden="true"></i>
          </button>
          <button
            class="ds-btn ds-btn-icon ds-btn-sm"
            id="timelineModeBtn"
            title="Timeline mode"
          >
            <i class="iconoir-clock-rotate-right" aria-hidden="true"></i>
          </button>
          <label class="subtle speed-wrap" for="speed" title="Playback speed">
            <input
              id="speed"
              type="range"
              min="0.1"
              max="4"
              value="1"
              step="0.1"
            />
          </label>
          <div class="spacer"></div>
          <button
            class="ds-btn ds-btn-danger ds-btn-icon ds-btn-sm"
            id="clearRoute"
            title="Clear route and outline"
          >
            <i class="iconoir-trash" aria-hidden="true"></i>
          </button>
          <button
            class="ds-btn ds-btn-primary route-btn"
            id="sampleRoute"
            title="Build route from pins"
          >
            <i class="iconoir-path-arrow-solid" aria-hidden="true"></i
            ><span>Route</span>
          </button>
        </div>
        <div class="timeline-slider-wrap">
          <div class="timeline-track-wrap">
            <div class="timeline-ruler-labels" aria-hidden="true">
              <span>0%</span>
              <span>25%</span>
              <span>50%</span>
              <span>75%</span>
              <span>100%</span>
            </div>
            <div
              id="timelineMarkers"
              class="timeline-markers"
              aria-hidden="false"
            ></div>
            <div
              id="timelinePlayhead"
              class="timeline-playhead"
              aria-hidden="true"
            ></div>
            <input id="timeline" type="range" min="0" max="1000" value="0" />
            <div class="timeline-ruler" aria-hidden="true"></div>
          </div>
        </div>
      </section>
    </main>

    <div
      id="toastWrap"
      class="toast-wrap"
      aria-live="polite"
      aria-atomic="true"
    ></div>

    <dialog id="confirmDeleteDialog" class="ds-modal">
      <div class="ds-modal-panel ds-stack">
        <div>
          <h3 class="ds-card-title">Delete Pin?</h3>
          <p class="ds-muted">
            This removes the selected pin from the journey.
          </p>
        </div>
        <div class="ds-toolbar">
          <button class="ds-btn" id="cancelDeleteBtn" type="button">
            Cancel
          </button>
          <button
            class="ds-btn ds-btn-danger"
            id="confirmDeleteBtn"
            type="button"
          >
            Delete
          </button>
        </div>
      </div>
    </dialog>

    <dialog id="helpDialog" class="ds-modal">
      <div class="ds-modal-panel ds-stack">
        <div>
          <h3 id="helpDialogTitle" class="ds-card-title">Panel Help</h3>
          <p id="helpDialogBody" class="ds-muted">No help text available.</p>
        </div>
        <div class="ds-toolbar">
          <button
            class="ds-btn ds-btn-primary"
            id="closeHelpDialogBtn"
            type="button"
          >
            Close
          </button>
        </div>
      </div>
    </dialog>

    <div
      id="mapSettingsHint"
      class="panel-status ds-status"
      hidden
      aria-hidden="true"
    ></div>
    <input
      id="showGeoGrid"
      type="checkbox"
      checked
      hidden
      aria-hidden="true"
      tabindex="-1"
    />
    <script src="./trekulate_v0.1.js"></script>
  </body>
</html>
